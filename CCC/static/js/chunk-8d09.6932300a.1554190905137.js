(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-8d09"],{bGxm:function(e,t,l){"use strict";l.r(t);var r=l("gDS+"),a=l.n(r),o=l("mCxE"),n=l("moiu"),i=l("6HaC"),s=l("NBqH"),c=l("gCMc"),d=l("CQJQ"),p=l("rpY/"),u=l("mkR2"),m=l("yo+U"),f={name:"AddStockPlan",components:{MyRequire:l("cObG").a,MySupplier:m.a,MyApply:u.a,MyDetail:p.a,MyDelivery:d.a,MyEmp:c.a},data:function(){var e=function(e,t,l){console.log(t),""===t?l(new Error("请选择")):l()};return{heji1:"",heji2:"",empcontrol:!1,requirecontrol:!1,applycontrol:!1,addpro:!0,addsouce:!0,choosedata:[],depts:[],planPersonId:"",stockControl:!1,stockPersonId:"",deliverycontrol:!1,types:[],typeparms:{pagenum:1,pagesize:99999},control:!1,personalForm:{createPersonId:3,countryId:1,repositoryId:438,regionId:2},personalrules:{stockType:[{required:!0,message:"请选择采购类别",trigger:"change"}],planDate:[{required:!0,message:"请选择计划日期",trigger:"change"}],stockDeptId:[{required:!0,message:"请选择采购部门",trigger:"change"}],sourceType:[{required:!0,message:"请选择源单类型",trigger:"change"}],planPersonId:[{required:!0,validator:e,trigger:"focus"}],stockPersonId:[{required:!0,validator:e,trigger:"focus"}]},list2:[],list3:[],validRules:{}}},created:function(){this.getTypes()},methods:{planMoney:function(e){return e.planMoney=e.basicPrice*e.planQuantity,e.planMoney},getSummaries:function(e){var t=e.columns,l=e.data,r=[];return t.forEach(function(e,t){if(0!==t){var a=l.map(function(t){return Number(t[e.property])});a.every(function(e){return isNaN(e)})?r[t]="":(r[t]=a.reduce(function(e,t){var l=Number(t);return isNaN(l)?e:e+t},0),r[t]+="")}else r[t]="总计"}),this.heji1=r[8],this.heji2=r[7],r[1]="",r[2]="",r[3]="",r[4]="",r[6]="",r[9]="",r[10]="",r[11]="",r[12]="",r},basicPrice:function(e){return Object(i.j)(e.productCode).then(function(t){200===t.data.ret&&(e.basicPrice=t.data.data.content.list[0].purchasePrice)}),e.basicPrice},changeDate:function(e,t){this.$refs.editable2.clear();for(var l=this.$refs.editable.getRecords(),r=0;r<l.length;r++)this.$refs.editable2.insert(l[r])},handlechoose:function(){this.empcontrol=!0},personName:function(e,t){e.row.supplierName=t.supplierName,e.row.supplierId=t.id,this.$refs.editable2.clear();var l=this.$refs.editable.getRecords();console.log(l);for(var r=0;r<l.length;r++)this.$refs.editable2.insert(l[r])},chooseType:function(){console.log(this.personalForm.sourceType),"1"===this.personalForm.sourceType||"2"===this.personalForm.sourceType?(this.addsouce=!1,this.addpro=!0,this.$refs.editable.clear(),this.$refs.editable2.clear()):"3"===this.personalForm.sourceType&&(this.addpro=!1,this.addsouce=!0,this.$refs.editable.clear(),this.$refs.editable2.clear())},handleAddproduct:function(){this.control=!0},productdetail:function(e){console.log(e);for(var t=this.$refs.editable.getRecords(),l=0;l<e.length;l++){for(var r=0;r<t.length;r++)if(e[l].productCode===t[r].productCode)return this.$notify.error({title:"错误",message:"物品已添加",offset:100}),!1;this.$refs.editable.insert(e[l])}},productdetail2:function(e){console.log(e);for(var t=this.$refs.editable2.getRecords(),l=0;l<e.length;l++){for(var r=0;r<t.length;r++)if(e[l].productCode===t[r].productCode)return this.$notify.error({title:"错误",message:"物品已添加",offset:100}),!1;this.$refs.editable2.insert(e[l])}},handleAddSouce:function(){"1"===this.personalForm.sourceType?this.applycontrol=!0:"2"===this.personalForm.sourceType&&(this.requirecontrol=!0)},apply:function(e){console.log(e);for(var t=this.$refs.editable.getRecords(),l=0;l<e.length;l++){for(var r=0;r<t.length;r++)if(e[l].productCode===t[r].productCode)return this.$notify.error({title:"错误",message:"物品已添加",offset:100}),!1;this.$refs.editable.insert(e[l])}},apply2:function(e){for(var t=this.$refs.editable2.getRecords(),l=0;l<e.length;l++){for(var r=0;r<t.length;r++)if(e[l].productCode===t[r].productCode)return this.$notify.error({title:"错误",message:"物品已添加",offset:100}),!1;this.$refs.editable2.insert(e[l])}},requiredata:function(e){console.log(e);for(var t=this.$refs.editable.getRecords(),l=0;l<e.length;l++){for(var r=0;r<t.length;r++)if(e[l].productCode===t[r].productCode)return this.$notify.error({title:"错误",message:"物品已添加",offset:100}),!1;this.$refs.editable.insert(e[l])}},requiredata2:function(e){for(var t=this.$refs.editable2.getRecords(),l=0;l<e.length;l++){for(var r=0;r<t.length;r++)if(e[l].productCode===t[r].productCode)return this.$notify.error({title:"错误",message:"物品已添加",offset:100}),!1;this.$refs.editable2.insert(e[l])}},deleteEdit:function(){this.$refs.editable.removeSelecteds(),console.log(this.$refs.editable);for(var e=this.$refs.editable2.getRecords(),t=0;t<e.length;t++)for(var l=0;l<this.choosedata.length;l++)e[t].productCode===this.choosedata[l].productCode&&this.$refs.editable2.remove(e[t]);console.log(e)},deleteChange:function(e){this.choosedata=e},updatecountry:function(){this.getTypes()},getTypes:function(){var e=this;Object(s.c)(this.typeparms).then(function(t){200===t.data.ret&&(e.types=t.data.data.content.list)}),Object(n.m)().then(function(t){200===t.data.ret&&(e.depts=t.data.data.content)})},handlechooseStock:function(){this.stockControl=!0},stockName:function(e){this.planPersonId=e.personName,this.personalForm.planPersonId=e.id},handlechooseDelivery:function(){this.deliverycontrol=!0},deliveryName:function(e){this.stockPersonId=e.personName,this.personalForm.stockPersonId=e.id},restAllForm:function(){this.personalForm={createPersonId:3,countryId:1,repositoryId:438,regionId:2},this.planPersonId=null,this.stockPersonId=null},handlesave:function(){var e=this,t=this.$refs.editable.getRecords(),l=this.$refs.editable2.getRecords();if(0===t.length)return this.$notify.error({title:"错误",message:"明细表不能为空",offset:100}),!1;l.map(function(e){return e}).forEach(function(e){return null!==e.productCode&&""!==e.productCode&&void 0!==e.productCode||delete e.productCode,null!==e.productName&&""!==e.productName&&void 0!==e.productName||delete e.productName,null!==e.typeId&&""!==e.typeId&&void 0!==e.typeId||delete e.typeId,null!==e.unit&&""!==e.unit&&void 0!==e.unit||delete e.unit,null!==e.color&&""!==e.color&&void 0!==e.color||delete e.color,null!==e.basicPrice&&""!==e.basicPrice&&void 0!==e.basicPrice||delete e.basicPrice,null!==e.basicQuantity&&""!==e.basicQuantity&&void 0!==e.basicQuantity||delete e.basicQuantity,null!==e.planQuantity&&""!==e.planQuantity&&void 0!==e.planQuantity||delete e.planQuantity,null!==e.planMoney&&""!==e.planMoney&&void 0!==e.planMoney||delete e.planMoney,null!==e.applyReason&&""!==e.applyReason&&void 0!==e.applyReason||delete e.applyReason,null!==e.sourceNumber&&""!==e.sourceNumber&&void 0!==e.sourceNumber||delete e.sourceNumber,null!==e.planDeliveryDate&&""!==e.planDeliveryDate&&void 0!==e.planDeliveryDate||delete e.planDeliveryDate,null!==e.supplierId&&""!==e.supplierId&&void 0!==e.supplierId||delete e.supplierId,e});var r=a()(t),n=this.personalForm;for(var i in n)""!==n[i]&&void 0!==n[i]&&null!==n[i]||delete n[i];var s=a()(n);this.$refs.personalForm.validate(function(t){if(!t)return e.$notify.error({title:"错误",message:"信息未填完整",offset:100}),!1;Object(o.a)(s,r,e.personalForm).then(function(t){console.log(t),200===t.data.ret?(e.$notify({title:"成功",message:"保存成功",type:"success",offset:100}),e.restAllForm(),e.$refs.editable.clear(),e.$refs.editable2.clear(),e.$refs.personalForm.clearValidate(),e.$refs.personalForm.resetFields()):e.$notify.error({title:"错误",message:t.data.msg,offset:100})})})},handlecancel:function(){this.$router.go(-1);this.$store.dispatch("delView",{path:"/StockPlan/AddStockPlan",name:"AddStockPlan",fullPath:"/StockPlan/AddStockPlan",title:"AddStockPlan"}).then(function(e){e.visitedViews})}}},h=(l("eQAK"),l("KHd+")),y=Object(h.a)(f,function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"ERP-container"},[l("div",{staticClass:"app-container",staticStyle:{"padding-right":"0"}},[l("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[l("h2",{ref:"geren",staticClass:"form-name"},[e._v("基本信息")]),e._v(" "),l("div",{staticClass:"container",staticStyle:{"margin-top":"37px"}},[l("el-form",{ref:"personalForm",staticClass:"demo-ruleForm",attrs:{model:e.personalForm,rules:e.personalrules,inline:!0,"status-icon":"","label-width":"130px"}},[l("el-row",[l("el-col",{attrs:{span:6}},[l("el-form-item",{staticStyle:{width:"100%"},attrs:{label:e.$t("StockPlan.title")}},[l("el-input",{staticStyle:{"margin-left":"18px"},attrs:{clearable:""},model:{value:e.personalForm.title,callback:function(t){e.$set(e.personalForm,"title",t)},expression:"personalForm.title"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:6}},[l("el-form-item",{staticStyle:{width:"100%"},attrs:{label:e.$t("StockPlan.stockType"),prop:"stockType"}},[l("el-select",{staticStyle:{"margin-left":"18px",width:"218px"},on:{focus:e.updatecountry},model:{value:e.personalForm.stockType,callback:function(t){e.$set(e.personalForm,"stockType",t)},expression:"personalForm.stockType"}},e._l(e.types,function(e,t){return l("el-option",{key:t,attrs:{label:e.categoryName,value:e.id}})}))],1)],1),e._v(" "),l("el-col",{attrs:{span:6}},[l("el-form-item",{staticStyle:{width:"100%"},attrs:{label:e.$t("StockPlan.planPersonId"),prop:"planPersonId"}},[l("el-input",{staticStyle:{"margin-left":"18px"},attrs:{clearable:""},on:{focus:e.handlechooseStock},model:{value:e.planPersonId,callback:function(t){e.planPersonId=t},expression:"planPersonId"}}),e._v(" "),l("my-emp",{attrs:{control:e.stockControl},on:{"update:control":function(t){e.stockControl=t},stockName:e.stockName}})],1)],1),e._v(" "),l("el-col",{attrs:{span:6}},[l("el-form-item",{staticStyle:{width:"100%"},attrs:{label:e.$t("StockPlan.stockPersonId"),prop:"stockPersonId"}},[l("el-input",{staticStyle:{"margin-left":"18px"},attrs:{clearable:""},on:{focus:e.handlechooseDelivery},model:{value:e.stockPersonId,callback:function(t){e.stockPersonId=t},expression:"stockPersonId"}}),e._v(" "),l("my-delivery",{attrs:{deliverycontrol:e.deliverycontrol},on:{"update:deliverycontrol":function(t){e.deliverycontrol=t},deliveryName:e.deliveryName}})],1)],1),e._v(" "),l("el-col",{attrs:{span:6}},[l("el-form-item",{staticStyle:{width:"100%"},attrs:{label:e.$t("StockPlan.stockDeptId"),prop:"stockDeptId"}},[l("el-select",{staticStyle:{"margin-left":"18px",width:"218px"},attrs:{clearable:""},model:{value:e.personalForm.stockDeptId,callback:function(t){e.$set(e.personalForm,"stockDeptId",t)},expression:"personalForm.stockDeptId"}},e._l(e.depts,function(e,t){return l("el-option",{key:t,attrs:{value:e.id,label:e.deptName}})}))],1)],1),e._v(" "),l("el-col",{attrs:{span:6}},[l("el-form-item",{staticStyle:{width:"100%"},attrs:{label:e.$t("StockPlan.sourceType")}},[l("el-select",{staticStyle:{"margin-left":"18px",width:"218px"},on:{change:e.chooseType},model:{value:e.personalForm.sourceType,callback:function(t){e.$set(e.personalForm,"sourceType",t)},expression:"personalForm.sourceType"}},[l("el-option",{attrs:{value:"1",label:"采购申请"}}),e._v(" "),l("el-option",{attrs:{value:"2",label:"采购需求"}}),e._v(" "),l("el-option",{attrs:{value:"3",label:"无来源"}})],1)],1)],1),e._v(" "),l("el-col",{attrs:{span:6}},[l("el-form-item",{staticStyle:{width:"100%"},attrs:{label:e.$t("StockPlan.planDate"),prop:"planDate"}},[l("el-date-picker",{staticStyle:{"margin-left":"18px"},attrs:{type:"date","value-format":"yyyy-MM-dd"},model:{value:e.personalForm.planDate,callback:function(t){e.$set(e.personalForm,"planDate",t)},expression:"personalForm.planDate"}})],1)],1)],1)],1)],1)]),e._v(" "),l("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"15px"},attrs:{shadow:"never"}},[l("h2",{ref:"fuzhu",staticClass:"form-name"},[e._v("采购计划来源明细")]),e._v(" "),l("div",{staticClass:"buttons",staticStyle:{"margin-top":"35px","margin-bottom":"10px"}},[l("el-button",{attrs:{disabled:e.addpro},on:{click:e.handleAddproduct}},[e._v("添加商品")]),e._v(" "),l("my-detail",{attrs:{control:e.control},on:{"update:control":function(t){e.control=t},product:e.productdetail,product2:e.productdetail2}}),e._v(" "),l("el-button",{staticStyle:{width:"130px"},attrs:{disabled:e.addsouce},on:{click:e.handleAddSouce}},[e._v("从源单中选择")]),e._v(" "),l("my-apply",{attrs:{applycontrol:e.applycontrol},on:{"update:applycontrol":function(t){e.applycontrol=t},apply:e.apply,apply2:e.apply2}}),e._v(" "),l("my-require",{attrs:{requirecontrol:e.requirecontrol},on:{"update:requirecontrol":function(t){e.requirecontrol=t},require:e.requiredata,require2:e.requiredata2}}),e._v(" "),l("el-button",{attrs:{type:"danger"},on:{click:e.deleteEdit}},[e._v("删除")])],1),e._v(" "),l("div",{staticClass:"container"},[l("el-editable",{ref:"editable",staticClass:"click-table1",staticStyle:{width:"100%"},attrs:{data:e.list2,"edit-config":{showIcon:!0,showStatus:!0},"edit-rules":e.validRules,stripe:"",border:"",size:"medium"},on:{"update:data":function(t){e.list2=t},"selection-change":e.deleteChange}},[l("el-editable-column",{attrs:{type:"selection","min-width":"55",align:"center"}}),e._v(" "),l("el-editable-column",{attrs:{label:"序号","min-width":"55",align:"center",type:"index"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"productCode",align:"center",label:"物品编号","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"productName",align:"center",label:"物品名称","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"productType",align:"center",label:"规格","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"color",align:"center",label:"颜色","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"unit",align:"center",label:"单位","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"basicPrice",align:"center",label:"单价","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("p",[e._v(e._s(e.basicPrice(t.row)))])]}}])}),e._v(" "),l("el-editable-column",{attrs:{"edit-render":{name:"ElInputNumber",attrs:{min:0},type:"visible",events:{change:e.changeDate}},prop:"planQuantity",align:"center",label:"计划数量","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"planMoney",align:"center",label:"计划金额","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("p",[e._v(e._s(e.planMoney(t.row)))])]}}])}),e._v(" "),l("el-editable-column",{attrs:{"edit-render":{name:"ElDatePicker",attrs:{type:"date",format:"yyyy-MM-dd"},type:"visible",events:{change:e.changeDate}},prop:"planDeliveryDate",align:"center",label:"计划交货日期","min-width":"170px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"applyReason",align:"center",label:"申请原因","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"sourceNumber",align:"center",label:"源单编号","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{"edit-render":{name:"ElInput",type:"visible"},prop:"supplierName",align:"center",label:"供应商","min-width":"150px"},scopedSlots:e._u([{key:"edit",fn:function(t){return[l("el-input",{attrs:{value:t.row.supplierName},on:{focus:e.handlechoose},model:{value:t.row.supplierName,callback:function(l){e.$set(t.row,"supplierName",l)},expression:"scope.row.supplierName"}}),e._v(" "),l("my-supplier",{attrs:{control:e.empcontrol},on:{"update:control":function(t){e.empcontrol=t},supplierName:function(l){e.personName(t,l)}}})]}}])})],1)],1)]),e._v(" "),l("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"15px"},attrs:{shadow:"never"}},[l("h2",{ref:"fuzhu",staticClass:"form-name"},[e._v("采购计划明细")]),e._v(" "),l("div",{staticClass:"container"},[l("el-editable",{ref:"editable2",staticClass:"click-table1",staticStyle:{width:"100%"},attrs:{data:e.list3,"edit-config":{showIcon:!0,showStatus:!0},"edit-rules":e.validRules,"summary-method":e.getSummaries,"show-summary":"",stripe:"",border:"",size:"medium"},on:{"update:data":function(t){e.list3=t}}},[l("el-editable-column",{attrs:{label:"序号",width:"60",align:"center",type:"index"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"productCode",align:"center",label:"物品编号","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"productName",align:"center",label:"物品名称","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"productType",align:"center",label:"规格","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"color",align:"center",label:"颜色","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"unit",align:"center",label:"单位","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"basicPrice",align:"center",label:"单价","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("p",[e._v(e._s(e.basicPrice(t.row)))])]}}])}),e._v(" "),l("el-editable-column",{attrs:{prop:"planQuantity",align:"center",label:"计划数量","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"planMoney",align:"center",label:"计划金额","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("p",[e._v(e._s(e.planMoney(t.row)))])]}}])}),e._v(" "),l("el-editable-column",{attrs:{"edit-render":{name:"ElDatePicker",attrs:{type:"date",format:"yyyy-MM-dd"},type:"default"},prop:"planDeliveryDate",align:"center",label:"计划交货日期","min-width":"170px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"applyReason",align:"center",label:"申请原因","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"sourceNumber",align:"center",label:"源单编号","min-width":"150px"}}),e._v(" "),l("el-editable-column",{attrs:{prop:"supplierName",align:"center",label:"供应商","min-width":"150px"}})],1)],1)]),e._v(" "),l("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[l("h2",{ref:"geren",staticClass:"form-name"},[e._v("合计信息")]),e._v(" "),l("div",{staticClass:"container",staticStyle:{"margin-top":"37px"}},[l("el-form",{ref:"personalForm2",staticClass:"demo-ruleForm",attrs:{model:e.personalForm,rules:e.personalrules,inline:!0,"status-icon":"","label-width":"130px"}},[l("el-row",[l("el-col",{attrs:{span:6}},[l("el-form-item",{staticStyle:{width:"100%"},attrs:{label:e.$t("StockPlan.heji1")}},[l("el-input",{staticStyle:{"margin-left":"18px"},attrs:{disabled:""},model:{value:e.heji1,callback:function(t){e.heji1=t},expression:"heji1"}})],1)],1),e._v(" "),l("el-col",{attrs:{span:6}},[l("el-form-item",{staticStyle:{width:"100%"},attrs:{label:e.$t("StockPlan.heji2")}},[l("el-input",{staticStyle:{"margin-left":"18px"},attrs:{disabled:""},model:{value:e.heji2,callback:function(t){e.heji2=t},expression:"heji2"}})],1)],1)],1)],1)],1)]),e._v(" "),l("div",{staticClass:"buttons",staticStyle:{"margin-top":"20px"}},[l("el-button",{staticStyle:{background:"#3696fd","border-color":"#3696fd",width:"98px"},attrs:{type:"primary"},on:{click:function(t){e.handlesave()}}},[e._v("保存")]),e._v(" "),l("el-button",{attrs:{type:"danger"},on:{click:function(t){e.handlecancel()}}},[e._v("取消")])],1)],1)])},[],!1,null,"dcac057a",null);y.options.__file="AddStockPlan.vue";t.default=y.exports},eQAK:function(e,t,l){"use strict";var r=l("jiL5");l.n(r).a},jiL5:function(e,t,l){}}]);