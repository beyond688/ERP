(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5882"],{"7o8I":function(t,e,a){"use strict";var l=a("C7BO");a.n(l).a},C7BO:function(t,e,a){},vS3T:function(t,e,a){"use strict";a.r(e);var l=a("gDS+"),r=a.n(l),o=a("iG2E"),n=a("moiu"),i=a("NBqH"),s=a("F+IB"),p={name:"AddStockApply",components:{MyDetail:a("f7Dy").a,MyEmp:s.a},data:function(){return{choosedata:[],depts:[],applyPersonId:"",stockControl:!1,types:[],typeparms:{pagenum:1,pagesize:99999},control:!1,personalForm:{createPersonId:3,countryId:1,repositoryId:438,regionId:2,sourceType:"1"},personalrules:{stockType:[{required:!0,message:"请选择采购类别",trigger:"change"}],applyDate:[{required:!0,message:"请选择申请日期",trigger:"change"}],applyDeptId:[{required:!0,message:"请选择申请部门",trigger:"change"}],sourceType:[{required:!0,message:"请选择源单类型",trigger:"change"}]},list2:[],list3:[],validRules:{}}},created:function(){this.getTypes()},methods:{deleteEdit:function(){this.$refs.editable.removeSelecteds(),console.log(this.$refs.editable);for(var t=this.$refs.editable2.getRecords(),e=0;e<t.length;e++)for(var a=0;a<this.choosedata.length;a++)t[e].productCode===this.choosedata[a].productCode&&this.$refs.editable2.remove(t[e]);console.log(t)},deleteChange:function(t){this.choosedata=t},updatecountry:function(){this.getTypes()},getTypes:function(){var t=this;Object(i.c)(this.typeparms).then(function(e){200===e.data.ret&&(t.types=e.data.data.content.list)}),Object(n.m)().then(function(e){200===e.data.ret&&(t.depts=e.data.data.content)})},handlechooseStock:function(){this.stockControl=!0},stockName:function(t){this.applyPersonId=t.personName,this.personalForm.applyPersonId=t.id},handleAddproduct:function(){this.control=!0},productdetail:function(t){console.log(t);for(var e=this.$refs.editable.getRecords(),a=0;a<t.length;a++){for(var l=0;l<e.length;l++)if(t[a].productCode===e[l].productCode)return this.$notify.error({title:"错误",message:"物品已添加",offset:100}),!1;this.$refs.editable.insert(t[a])}},productdetail2:function(t){console.log(t);for(var e=this.$refs.editable2.getRecords(),a=0;a<t.length;a++){for(var l=0;l<e.length;l++)if(t[a].productCode===e[l].productCode)return this.$notify.error({title:"错误",message:"物品已添加",offset:100}),!1;this.$refs.editable2.insert(t[a])}},restAllForm:function(){this.personalForm={createPersonId:3,countryId:1,repositoryId:438,regionId:2,sourceType:"1"},this.applyPersonId=null},handlesave:function(){for(var t=this,e=this.$refs.editable.getRecords(),a=this.$refs.editable2.getRecords(),l=0;l<e.length;l++)for(var n=0;n<a.length;n++)if(e[l].productCode===a[n].productCode){e[l].applyQuantity=a[n].applyQuantity,e[l].planQuantity=a[n].planQuantity;break}if(0===e.length)return this.$notify.error({title:"错误",message:"明细表不能为空",offset:100}),!1;e.map(function(t){return t}).forEach(function(t){return null!==t.productCode&&""!==t.productCode&&void 0!==t.productCode||delete t.productCode,null!==t.productName&&""!==t.productName&&void 0!==t.productName||delete t.productName,null!==t.typeId&&""!==t.typeId&&void 0!==t.typeId||delete t.typeId,null!==t.unit&&""!==t.unit&&void 0!==t.unit||delete t.unit,null!==t.basicQuantity&&""!==t.basicQuantity&&void 0!==t.basicQuantity||delete t.basicQuantity,null!==t.requireQuantity&&""!==t.requireQuantity&&void 0!==t.requireQuantity||delete t.requireQuantity,null!==t.applyQuantity&&""!==t.applyQuantity&&void 0!==t.applyQuantity||delete t.applyQuantity,null!==t.requireDate&&""!==t.requireDate&&void 0!==t.requireDate||delete t.requireDate,null!==t.applyReason&&""!==t.applyReason&&void 0!==t.applyReason||delete t.applyReason,null!==t.planQuantity&&""!==t.planQuantity&&void 0!==t.planQuantity||delete t.planQuantity,t});var i=r()(e),s=this.personalForm;for(var p in s)""!==s[p]&&void 0!==s[p]&&null!==s[p]||delete s[p];var c=r()(s);this.$refs.personalForm.validate(function(e){if(!e)return t.$notify.error({title:"错误",message:"信息未填完整",offset:100}),!1;Object(o.a)(c,i,t.personalForm).then(function(e){console.log(e),200===e.data.ret?(t.$notify({title:"成功",message:"保存成功",type:"success",offset:100}),t.restAllForm(),t.$refs.editable.clear(),t.$refs.editable2.clear(),t.$refs.personalForm.clearValidate(),t.$refs.personalForm.resetFields()):t.$notify.error({title:"错误",message:e.data.msg,offset:100})})})},handlecancel:function(){this.$router.go(-1);this.$store.dispatch("delView",{path:"/StockApply/AddStockApply",name:"AddStockApply",fullPath:"/StockApply/AddStockApply",title:"AddStockApply"}).then(function(t){t.visitedViews})}}},c=(a("7o8I"),a("KHd+")),d=Object(c.a)(p,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ERP-container"},[a("div",{staticClass:"app-container",staticStyle:{"padding-right":"0"}},[a("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[a("h2",{ref:"geren",staticClass:"form-name"},[t._v("基本信息")]),t._v(" "),a("div",{staticClass:"container",staticStyle:{"margin-top":"37px"}},[a("el-form",{ref:"personalForm",staticClass:"demo-ruleForm",attrs:{model:t.personalForm,rules:t.personalrules,inline:!0,"status-icon":"","label-width":"130px"}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:t.$t("StockApply.title")}},[a("el-input",{staticStyle:{"margin-left":"18px"},attrs:{clearable:""},model:{value:t.personalForm.title,callback:function(e){t.$set(t.personalForm,"title",e)},expression:"personalForm.title"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:t.$t("StockApply.stockType"),prop:"stockType"}},[a("el-select",{staticStyle:{"margin-left":"18px",width:"218px"},on:{focus:t.updatecountry},model:{value:t.personalForm.stockType,callback:function(e){t.$set(t.personalForm,"stockType",e)},expression:"personalForm.stockType"}},t._l(t.types,function(t,e){return a("el-option",{key:e,attrs:{label:t.categoryName,value:t.id}})}))],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:t.$t("StockApply.applyPersonId")}},[a("el-input",{staticStyle:{"margin-left":"18px"},attrs:{clearable:""},on:{focus:t.handlechooseStock},model:{value:t.applyPersonId,callback:function(e){t.applyPersonId=e},expression:"applyPersonId"}}),t._v(" "),a("my-emp",{attrs:{control:t.stockControl},on:{"update:control":function(e){t.stockControl=e},stockName:t.stockName}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:t.$t("StockApply.applyDeptId"),prop:"applyDeptId"}},[a("el-select",{staticStyle:{"margin-left":"18px"},attrs:{clearable:""},model:{value:t.personalForm.applyDeptId,callback:function(e){t.$set(t.personalForm,"applyDeptId",e)},expression:"personalForm.applyDeptId"}},t._l(t.depts,function(t,e){return a("el-option",{key:e,attrs:{value:t.id,label:t.deptName}})}))],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:t.$t("StockApply.sourceType"),prop:"sourceType"}},[a("el-select",{staticStyle:{"margin-left":"18px",width:"218px"},model:{value:t.personalForm.sourceType,callback:function(e){t.$set(t.personalForm,"sourceType",e)},expression:"personalForm.sourceType"}},[a("el-option",{attrs:{value:"1",label:"无来源"}})],1)],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:t.$t("StockApply.applyDate"),prop:"applyDate"}},[a("el-date-picker",{staticStyle:{"margin-left":"18px"},attrs:{type:"date","value-format":"yyyy-MM-dd"},model:{value:t.personalForm.applyDate,callback:function(e){t.$set(t.personalForm,"applyDate",e)},expression:"personalForm.applyDate"}})],1)],1)],1)],1)],1)]),t._v(" "),a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"15px"},attrs:{shadow:"never"}},[a("h2",{ref:"fuzhu",staticClass:"form-name"},[t._v("采购申请明细来源")]),t._v(" "),a("div",{staticClass:"buttons",staticStyle:{"margin-top":"35px","margin-bottom":"10px"}},[a("el-button",{staticStyle:{background:"#3696fd","border-color":"#3696fd"},attrs:{type:"success"},on:{click:t.handleAddproduct}},[t._v("添加商品")]),t._v(" "),a("my-detail",{attrs:{control:t.control},on:{"update:control":function(e){t.control=e},product:t.productdetail,product2:t.productdetail2}}),t._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:t.deleteEdit}},[t._v("删除")])],1),t._v(" "),a("div",{staticClass:"container"},[a("el-editable",{ref:"editable",staticClass:"click-table1",staticStyle:{width:"100%"},attrs:{data:t.list2,"edit-config":{showIcon:!0,showStatus:!0},"edit-rules":t.validRules,stripe:"",border:"",size:"medium"},on:{"update:data":function(e){t.list2=e},"selection-change":t.deleteChange}},[a("el-editable-column",{attrs:{type:"selection","min-width":"55",align:"center"}}),t._v(" "),a("el-editable-column",{attrs:{label:"序号","min-width":"55",align:"center",type:"index"}}),t._v(" "),a("el-editable-column",{attrs:{prop:"productCode",align:"center",label:"物品编号","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{prop:"productName",align:"center",label:"物品名称","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{prop:"productType",align:"center",label:"规格","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{prop:"color",align:"center",label:"颜色","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{prop:"unit",align:"center",label:"单位","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{"edit-render":{name:"ElInputNumber",attrs:{min:0},type:"visible"},prop:"requireQuantity",align:"center",label:"需求数量","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{"edit-render":{name:"ElDatePicker",attrs:{type:"date",format:"yyyy-MM-dd"},type:"visible"},prop:"requireDate",align:"center",label:"需求日期","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{"edit-render":{name:"ElInput",type:"visible"},prop:"applyReason",align:"center",label:"申请原因","min-width":"150px"}})],1)],1)]),t._v(" "),a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"15px"},attrs:{shadow:"never"}},[a("h2",{ref:"fuzhu",staticClass:"form-name"},[t._v("采购申请明细")]),t._v(" "),a("div",{staticClass:"container"},[a("el-editable",{ref:"editable2",staticClass:"click-table1",staticStyle:{width:"100%"},attrs:{data:t.list3,"edit-config":{showIcon:!0,showStatus:!0},"edit-rules":t.validRules,stripe:"",border:"",size:"medium"},on:{"update:data":function(e){t.list3=e}}},[a("el-editable-column",{attrs:{label:"序号","min-width":"55",align:"center",type:"index"}}),t._v(" "),a("el-editable-column",{attrs:{prop:"productCode",align:"center",label:"物品编号","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{prop:"productName",align:"center",label:"物品名称","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{prop:"productType",align:"center",label:"规格","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{prop:"color",align:"center",label:"颜色","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{prop:"unit",align:"center",label:"单位","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{"edit-render":{name:"ElInputNumber",attrs:{min:0},type:"visible"},prop:"applyQuantity",align:"center",label:"申请数量","min-width":"150px"}}),t._v(" "),a("el-editable-column",{attrs:{"edit-render":{name:"ElInputNumber",attrs:{min:0},type:"visible"},prop:"planQuantity",align:"center",label:"已计划数量","min-width":"150px"}})],1)],1)]),t._v(" "),a("div",{staticClass:"buttons",staticStyle:{"margin-top":"20px"}},[a("el-button",{staticStyle:{background:"#3696fd","border-color":"#3696fd",width:"98px"},attrs:{type:"primary"},on:{click:function(e){t.handlesave()}}},[t._v("保存")]),t._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(e){t.handlecancel()}}},[t._v("取消")])],1)],1)])},[],!1,null,"ffca5054",null);d.options.__file="AddStockApply.vue";e.default=d.exports}}]);